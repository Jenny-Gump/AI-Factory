# üîó Link Processing - –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫

## üìñ –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –≤–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ —á–µ—Ä–µ–∑ 4-—ç—Ç–∞–ø–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω. –ù–∞—Ö–æ–¥–∏—Ç –º–µ—Å—Ç–∞ –≥–¥–µ —á–∏—Ç–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∑–∞—Ö–æ—Ç–µ—Ç—å –ü–†–û–í–ï–†–ò–¢–¨ –∏–ª–∏ –ò–ó–£–ß–ò–¢–¨ –ì–õ–£–ë–ñ–ï —Ç–µ–º—É –∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç 10-20 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ —Å –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã (–ü–†–ê–í–ò–õ–¨–ù–ê–Ø)

### –≠—Ç–∞–ø 1: Link Planning (Anchor Text —Å–∏—Å—Ç–µ–º–∞)
- **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ HTML**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ `[HEADER_START]`, `[CODE_START]`, `[FORMAT_START]` –¥–ª—è –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏—è –∑–æ–Ω, –≥–¥–µ –Ω–µ —Å–ª–µ–¥—É–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å —è–∫–æ—Ä—è
- **LLM –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π HTML** —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ –¥–ª—è –∏–∑–±–µ–≥–∞–Ω–∏—è –≤—ã–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–≥–æ–≤
- **–ù–∞—Ö–æ–¥–∏—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞** (`anchor_text`) —Ç–æ–ª—å–∫–æ –≤ –æ–±—ã—á–Ω–æ–º —Ç–µ–∫—Å—Ç–µ, –∏–∑–±–µ–≥–∞—è:
  - –ó–∞–≥–æ–ª–æ–≤–∫–∏ (`<h1>`, `<h2>`, `<h3>`)
  - –ö–æ–¥ (`<code>`, `<pre>`)
  - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (`<strong>`, `<em>`)
- **–°–æ–∑–¥–∞–µ—Ç 10-20 –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ `anchor_text`
- **–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç** –¥–æ –∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ (`context_before`, `context_after`)
- **–ú–æ–¥–µ–ª—å**: `deepseek-chat` —Å fallback –Ω–∞ Gemini
- **–ü—Ä–æ–º–ø—Ç**: `prompts/basic_articles/01_5_link_planning.txt` —Å –Ω–æ–≤—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –≤—ã–±–æ—Ä–∞ —è–∫–æ—Ä–µ–π
- **–í—ã—Ö–æ–¥**: JSON —Å –º–∞—Å—Å–∏–≤–æ–º `{"ref_id": 1, "anchor_text": "Least-to-Most —Ç–µ—Ö–Ω–∏–∫–∞", "query": "least to most prompting research", "context_before": "–º–µ—Ç–æ–¥ ", "context_after": " —è–≤–ª—è–µ—Ç—Å—è"}`

### –≠—Ç–∞–ø 2: Anchor Validation
- **–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** —Ç–æ–ª—å–∫–æ `anchor_text` –±–µ–∑ —Å—Ç—Ä–æ–≥–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **–î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–∏—Å–∫**:
  1. –°–Ω–∞—á–∞–ª–∞ –∏—â–µ—Ç –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º HTML
  2. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - fallback —á–µ—Ä–µ–∑ BeautifulSoup –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º —Ç–µ–∫—Å—Ç–µ
- **–§—É–Ω–∫—Ü–∏—è**: `_validate_anchors()` —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø—Ä–æ–±–µ–ª–æ–≤
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û—Ç—á–µ—Ç –æ –≤–∞–ª–∏–¥–Ω—ã—Ö/–Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∞–Ω–∫–æ—Ä–∞—Ö
- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ**: –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ —è–∫–æ—Ä—è –ø—Ä–æ—Å—Ç–æ –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –≠—Ç–∞–ø 3: Search Candidates
- **Firecrawl Search API** –∏—â–µ—Ç –ø–æ –∫–∞–∂–¥–æ–º—É `query` (–ª–∏–º–∏—Ç 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å)
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤** –ø–æ –±–µ–ª–æ–º—É/—á–µ—Ä–Ω–æ–º—É —Å–ø–∏—Å–∫—É –∏–∑ `filters/preferred_domains.json`
- **HEAD –ø—Ä–æ–≤–µ—Ä–∫–∞** –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å—Å—ã–ª–æ–∫ (2s timeout)
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è rate limiting
- **–í—ã—Ö–æ–¥**: `candidates_{ref_id}.json` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

### –≠—Ç–∞–ø 4: LLM Link Selection
- **LLM –∞–Ω–∞–ª–∏–∑ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ `anchor_text`
- **–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**: `anchor_text`, `context`, —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
- **–ü—Ä–æ–º–ø—Ç**: `prompts/basic_articles/02_link_selection.txt`
- **–ú–æ–¥–µ–ª—å**: `deepseek-chat` –¥–ª—è –≤—ã–±–æ—Ä–∞ –ª—É—á—à–µ–π —Å—Å—ã–ª–∫–∏
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: docs.* > –Ω–∞—É—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ > GitHub > –æ—Å—Ç–∞–ª—å–Ω—ã–µ
- **–í—ã—Ö–æ–¥**: `selected_links.json` —Å –ª—É—á—à–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏

### –≠—Ç–∞–ø 5: Smart Positioning & Apply Links
- **–£–º–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ–∑–∏—Ü–∏–π** —á–µ—Ä–µ–∑ `_find_best_insertion_point()`
- **–ü–æ–∏—Å–∫ –ø–æ anchor_text** —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–æ/–ø–æ—Å–ª–µ
- **–í—Å—Ç–∞–≤–∫–∞ –º–∞—Ä–∫–µ—Ä–æ–≤** `[1]` –ø–æ—Å–ª–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ `anchor_text`
- **–ó–∞–º–µ–Ω–∞ –Ω–∞ HTML** —Å—Å—ã–ª–∫–∏ —Å –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ "–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏"** –≤–Ω–∏–∑—É —Å—Ç–∞—Ç—å–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è HTML** —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Anchor Text —Å–∏—Å—Ç–µ–º—ã (September 2025)

### ‚úÖ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã:

#### 1. Anchor Text –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–ù–ï –ø–æ–∑–∏—Ü–∏–∏ —Å–∏–º–≤–æ–ª–æ–≤!)
```python
def _find_best_insertion_point(self, text: str, anchor_text: str, context_before: str, context_after: str) -> int:
    # –ü–æ–∏—Å–∫ —Ç–æ—á–Ω–æ–π —Ñ—Ä–∞–∑—ã —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
    search_pattern = context_before + anchor_text + context_after
    pattern_pos = text.find(search_pattern)

    if pattern_pos != -1:
        # –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –ü–û–°–õ–ï anchor_text
        anchor_start = pattern_pos + len(context_before)
        anchor_end = anchor_start + len(anchor_text)
        return self._adjust_position_to_avoid_tags(text, anchor_end)
```

#### 2. –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ HTML –¥–ª—è LLM
```python
def _prepare_html_for_llm(self, html_content: str) -> str:
    # –ü–æ–º–µ—á–∞–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∏–∑–±–µ–≥–∞–Ω–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —è–∫–æ—Ä–µ–π
    content = content.replace('<h2>', '[HEADER_START]<h2>')
    content = content.replace('</h2>', '</h2>[HEADER_END]')
    content = content.replace('<code>', '[CODE_START]<code>')
    content = content.replace('</code>', '</code>[CODE_END]')
    content = content.replace('<strong>', '[FORMAT_START]<strong>')
    content = content.replace('</strong>', '</strong>[FORMAT_END]')
```

#### 3. –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —è–∫–æ—Ä–µ–π
```python
def _validate_anchors(self, html_content: str, link_plan: List[Dict]) -> Dict:
    # –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–∏—Å–∫ anchor_text
    soup = BeautifulSoup(html_content, 'html.parser')
    clean_text_normalized = ' '.join(soup.get_text().split())

    # –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –≤ HTML
    if anchor_text in html_content:
        # –ù–∞–π–¥–µ–Ω–æ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ
    # –ó–∞—Ç–µ–º fallback –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º —Ç–µ–∫—Å—Ç–µ
    elif anchor_normalized in clean_text_normalized:
        # –ù–∞–π–¥–µ–Ω–æ –≤ —á–∏—Å—Ç–æ–º —Ç–µ–∫—Å—Ç–µ
```

#### 4. LLM –∞–Ω–∞–ª–∏–∑ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å—Å—ã–ª–æ–∫
```python
messages = _load_and_prepare_messages(
    "basic_articles",
    "02_link_selection",  # ‚úÖ –§–ê–ô–õ –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø –ö–û–†–†–ï–ö–¢–ù–û!
    {
        "anchor_text": link_item.get("anchor_text", ""),
        "context": f"{context_before} {context_after}",
        "candidates": json.dumps(candidates, indent=2)
    }
)
```

#### 5. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ ref_id
```python
# –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ —Å anchor_text
link_plan = [
    {
        "ref_id": "1",
        "anchor_text": "Least-to-Most —Ç–µ—Ö–Ω–∏–∫–∞",
        "query": "least to most prompting research arxiv",
        "context_before": "–º–µ—Ç–æ–¥ ",
        "context_after": " —è–≤–ª—è–µ—Ç—Å—è",
        "hint": "–ù–∞—É—á–Ω–∞—è —Å—Ç–∞—Ç—å—è –æ LTM –ø—Ä–æ–º–ø—Ç–∏–Ω–≥–µ"
    }
]

# –≠—Ç–∞–ø 2: –ü–æ–∏—Å–∫ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ ref_id
for plan in link_plan:
    candidates = firecrawl_search(plan["query"])
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ candidates_{ref_id}.json

# –≠—Ç–∞–ø 3: LLM –≤—ã–±–æ—Ä –ª—É—á—à–µ–π —Å—Å—ã–ª–∫–∏
for ref_id, candidates in all_candidates.items():
    selected = llm_select_best_link(anchor_text, context, candidates)
    # ‚úÖ –ò–°–ü–û–õ–¨–ó–£–ï–¢ 02_link_selection.txt –ö–û–†–†–ï–ö–¢–ù–û!

# –≠—Ç–∞–ø 4: –£–º–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –ø–æ—Å–ª–µ anchor_text
for plan in validated_plans:
    position = _find_best_insertion_point(
        content, plan["anchor_text"],
        plan["context_before"], plan["context_after"]
    )
    # –í—Å—Ç–∞–≤–∫–∞ [ref_id] –≤ –Ω–∞–π–¥–µ–Ω–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`src/config.py`):
```python
LINK_PROCESSING_ENABLED = True  # –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Å—Å—ã–ª–æ–∫
LINK_MAX_QUERIES = 15          # –ú–∞–∫—Å–∏–º—É–º –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Å—Ç–∞—Ç—å—é
LINK_MAX_CANDIDATES_PER_QUERY = 5  # –ú–∞–∫—Å–∏–º—É–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ –∑–∞–ø—Ä–æ—Å
LINK_PROCESSING_TIMEOUT = 360      # –¢–∞–π–º–∞—É—Ç –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ (6 –º–∏–Ω—É—Ç)
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤ (`filters/preferred_domains.json`):

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã** (–≤—ã—Å–æ–∫–∏–π scoring):
```json
{
  "priority_domains": [
    "docs.microsoft.com", "developer.mozilla.org",
    "docs.github.com", "developers.google.com",
    "w3.org", "ietf.org", "arxiv.org",
    "openreview.net", "papers.nips.cc"
  ],
  "blocked_domains": [
    "reddit.com", "stackoverflow.com", "medium.com",
    "dev.to", "blogger.com", "quora.com"
  ],
  "priority_paths": [
    "/docs", "/documentation", "/api", "/reference",
    "/guide", "/tutorial", "/spec", "/standards"
  ]
}
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –í –æ—Å–Ω–æ–≤–Ω–æ–º –ø–∞–π–ø–ª–∞–π–Ω–µ:
```bash
# main.py –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç basic_articles_pipeline —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å—Å—ã–ª–∫–∞–º–∏
python3 main.py "JavaScript best practices"

# –î–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–π –ø—Ä–æ–º–ø—Ç–æ–≤ (–±–µ–∑ —Å—Å—ã–ª–æ–∫)
python3 batch_processor.py topics_file.txt --content-type prompt_collection
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥:
```python
from src.link_processor import LinkProcessor

processor = LinkProcessor()
result = processor.process_links(
    wordpress_data=wordpress_data,
    topic="Machine Learning trends 2024",
    base_path="output/article",
    token_tracker=tracker,
    active_models=active_models
)
```

## üìÅ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

–ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã –≤ `output/article/10_link_processing/`:
- `link_plan.json` - –ø–ª–∞–Ω —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫ –æ—Ç LLM
- `draft_with_markers.html` - HTML —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ [1]..[N]
- `candidates.json` - –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –æ—Ç Firecrawl
- `selected_links.json` - –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏ —Å –æ—Ü–µ–Ω–∫–∞–º–∏
- `article_with_links.html` - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç—å—è —Å —Å—Å—ã–ª–∫–∞–º–∏
- `links_report.json` - –æ—Ç—á–µ—Ç –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
- `marker_insertions_debug.json` - –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `llm_responses_raw/link_plan_response.txt` - —Å—ã—Ä–æ–π –æ—Ç–≤–µ—Ç LLM

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã

**–î–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏**:
```html
<p>–¢–µ—Ö–Ω–∏–∫–∞ Least-to-Most –ø—Ä–æ–º–ø—Ç–∏–Ω–≥–∞ ‚Äî —ç—Ç–æ –ø–æ–¥—Ö–æ–¥ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ò–ò.</p>
```

**–ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏**:
```html
<p>–¢–µ—Ö–Ω–∏–∫–∞ Least-to-Most –ø—Ä–æ–º–ø—Ç–∏–Ω–≥–∞<a id="cite-1" href="#ref-1" rel="nofollow">[1]</a> ‚Äî —ç—Ç–æ –ø–æ–¥—Ö–æ–¥ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ò–ò.</p>

<h2>–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h2>
<ol>
  <li id="ref-1">
    <a href="https://arxiv.org/abs/2205.10625" target="_blank" rel="nofollow noopener">
      [2205.10625] Least-to-Most Prompting Enables Complex Reasoning
    </a>
    <a href="#cite-1" aria-label="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –º–µ—Å—Ç—É —Å—Å—ã–ª–∫–∏ [1]">[‚Üë]</a>
  </li>
</ol>
```

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –¢–∏–ø–∏—á–Ω—ã–π –ª–æ–≥ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏:
```
=== Starting Link Processing Pipeline ===
Step 1: Creating link plan...
‚úì Generated 12 link queries with markers
Step 2: Searching for link candidates...
‚úì Found 45 total candidates across 12 queries
Step 3: Selecting best links...
‚úì Selected 10/12 links
Step 4: Applying links to content...
‚úì Applied 10 sequential academic footnotes to content
Link processing report: 10/12 resolved (83.3%)
=== Link Processing Complete (42.3s) ===
```

### –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è:

**"No markers found in headers"** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –º–∞—Ä–∫–µ—Ä—ã –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ —Ç–µ–∫—Å—Ç

**"No nested anchor tags found"** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**
- –ò—Å–∫–ª—é—á–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç—ã–µ –º–∞—Ä–∫–µ—Ä—ã [N]

**"Failed to parse link plan JSON"** ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û**
- –î–æ–±–∞–≤–ª–µ–Ω fallback –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ markdown –±–ª–æ–∫–æ–≤

**"Link processing failed"** - –°–∏—Å—Ç–µ–º–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ –≤ `logs/operations.jsonl`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Firecrawl API –∫–ª—é—á–∞

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞

**–¶–µ–ª—å**: >70% success rate –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–∏

**–¢–∏–ø–∏—á–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏**:
- **–ù–∞–π–¥–µ–Ω–æ —Å—Å—ã–ª–æ–∫**: 85-95% –æ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
- **–ö–∞—á–µ—Å—Ç–≤–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤**: 70%+ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ/–Ω–∞—É—á–Ω—ã–µ
- **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏**: 30-60 —Å–µ–∫—É–Ω–¥
- **HTML –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å**: 100% (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)

**–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢**

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:
```bash
python test_link_fixes.py
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
‚úì Generated X link positions
‚úì No markers found in headers
‚úì No nested anchor tags found
‚úì Final content has no nested anchor tags
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 19 —Å–µ–Ω—Ç—è–±—Ä—è 2025 - –£–ù–ò–§–ò–ö–ê–¶–ò–Ø –°–ò–°–¢–ï–ú–´
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–û** - LLM —Å–µ–ª–µ–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–æ–º–ø—Ç–æ–º 02_link_selection.txt
**–í–Ω–∏–º–∞–Ω–∏–µ**: –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –≤–µ—Ä—Å–∏–∏ –∫–æ–¥–∞, —Å–∏—Å—Ç–µ–º–∞ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –í –ù–û–í–û–ô –í–ï–†–°–ò–ò

### –£—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**: –£–¥–∞–ª–µ–Ω–∞ sync –≤–µ—Ä—Å–∏—è, –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ async –≤–µ—Ä—Å–∏—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è LLM —Å–µ–ª–µ–∫—Ü–∏—è**: –ó–∞–º–µ–Ω–µ–Ω –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π `_llm_tiebreaker` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `02_link_selection.txt`
3. **–û—à–∏–±–∫–∞ reindexing**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–Ω—É–º–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø—É—Ç–∞–Ω–∏—Ü—ã

### –§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ (–°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢ –ö–û–î–£):
1. **Link Planning**: LLM —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞–Ω —Å `anchor_text` + –∫–æ–Ω—Ç–µ–∫—Å—Ç
2. **Anchor Validation**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è `anchor_text` –≤ HTML
3. **Search Candidates**: Firecrawl –ø–æ–∏—Å–∫ –ø–æ –∫–∞–∂–¥–æ–º—É `query` (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏)
4. **LLM Selection**: ‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–´–ô 02_link_selection.txt**
5. **Smart Positioning**: –ü–æ–∏—Å–∫ –ø–æ–∑–∏—Ü–∏–∏ –ü–û–°–õ–ï –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ `anchor_text`
6. **Apply Links**: –ó–∞–º–µ–Ω–∞ –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ —Å—Å—ã–ª–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π

## üîÑ –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø (September 2025)

### September 20, 2025 - –£–ª—É—á—à–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —è–∫–æ—Ä–µ–π
**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ HTML —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏ –¥–ª—è –∏–∑–±–µ–≥–∞–Ω–∏—è –≤—ã–±–æ—Ä–∞ —è–∫–æ—Ä–µ–π –≤ —Ç–µ–≥–∞—Ö
- –£–ø—Ä–æ—â–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è - —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ anchor_text –±–µ–∑ —Å—Ç—Ä–æ–≥–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –î–æ–±–∞–≤–ª–µ–Ω fallback —á–µ—Ä–µ–∑ BeautifulSoup –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º —Ç–µ–∫—Å—Ç–µ
- –û–±–Ω–æ–≤–ª–µ–Ω –ø—Ä–æ–º–ø—Ç —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏–∑–±–µ–≥–∞–Ω–∏—è HTML —Ç–µ–≥–æ–≤ (h2, h3, code, strong, em)

### September 20, 2025 - –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
**–í–ê–ñ–ù–û**: –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**:
- –£–±—Ä–∞–Ω—ã –≤—Å–µ `async/await` –∏–∑ LinkProcessor
- –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —ç—Ç–∞–ø–æ–≤ –±–µ–∑ event loop –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- –ü—Ä–æ—Å—Ç–æ–π –ª–∏–Ω–µ–π–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –±–µ–∑ deadlock'–æ–≤